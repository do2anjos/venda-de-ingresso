using Microsoft.AspNetCore.Mvc;using Microsoft.EntityFrameworkCore;using VendaDeIngresso.Api.Data;using VendaDeIngresso.Api.Models;namespace VendaDeIngresso.Api.Controllers;[ApiController][Route("api/reserva")]public class ReservaController : ControllerBase{    private readonly CinemaContext _context;    public ReservaController(CinemaContext context)    {        _context = context;    }    [HttpPost("{assentoId}")]    public async Task<IActionResult> ReservarAssento(int assentoId, [FromBody] string usuarioId)    {        var agora = DateTime.UtcNow;        var assento = await _context.Assento.FindAsync(assentoId);        if (assento == null)            return NotFound("Assento não existe.");        var vendido = await _context.Venda            .AnyAsync(v => v.AssentoId == assentoId);        if (vendido)            return BadRequest("Assento já ocupado.");        var reservaExistente = await _context.Reserva            .AnyAsync(r => r.AssentoId == assentoId && r.DataExpiracao > agora);        if (reservaExistente)            return BadRequest("Assento já reservado.");        var reserva = new Reserva        {            AssentoId = assentoId,            UsuarioId = usuarioId,            DataReserva = agora,            DataExpiracao = agora.AddMinutes(2)        };        _context.Reserva.Add(reserva);        await _context.SaveChangesAsync();        return Ok(new { mensagem = "Assento reservado por 2 minutos.", reservaId = reserva.ReservaId });    }    [HttpDelete("{assentoId}")]    public async Task<IActionResult> CancelarReserva(int assentoId, [FromQuery] string usuarioId)    {        var reserva = await _context.Reserva            .FirstOrDefaultAsync(r => r.AssentoId == assentoId && r.UsuarioId == usuarioId);        if (reserva == null)            return NotFound("Reserva não encontrada ou não pertence ao usuário.");        _context.Reserva.Remove(reserva);        await _context.SaveChangesAsync();        return Ok(new { mensagem = "Reserva cancelada." });    }}